<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>App Validation - OpenMLS Book</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OpenMLS Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="app-validation"><a class="header" href="#app-validation">App Validation</a></h1>
<blockquote>
<p><strong>NOTE:</strong> This chapter described the validation steps an application, using OpenMLS, has to perform for safe operation of the MLS protocol.</p>
<p><strong>⚠️</strong> This chapter is work in progress (see <a href="https://github.com/openmls/openmls/issues/1504">#1504</a>).</p>
</blockquote>
<h2 id="credential-validation"><a class="header" href="#credential-validation">Credential Validation</a></h2>
<h3 id="acceptable-presented-identifiers"><a class="header" href="#acceptable-presented-identifiers">Acceptable Presented Identifiers</a></h3>
<blockquote>
<p>The application using MLS is responsible for specifying which identifiers
it finds acceptable for each member in a group. In other words, following
the model that [<a href="https://www.rfc-editor.org/rfc/rfc6125.html">RFC6125</a>] describes for TLS, the application maintains a list
of "reference identifiers" for the members of a group, and the credentials
provide "presented identifiers". A member of a group is authenticated by first
validating that the member's credential legitimately represents some presented
identifiers, and then ensuring that the reference identifiers for the member
are authenticated by those presented identifiers</p>
<p>-- <a href="https://www.rfc-editor.org/rfc/rfc9420.html#section-5.3.1-1">RFC9420, Section 5.3.1</a></p>
</blockquote>
<h3 id="validity-of-updated-presented-identifiers"><a class="header" href="#validity-of-updated-presented-identifiers">Validity of Updated Presented Identifiers</a></h3>
<blockquote>
<p>In cases where a member's credential is being replaced, such as the Update and
Commit cases above, the AS MUST also verify that the set of presented identifiers
in the new credential is valid as a successor to the set of presented identifiers
in the old credential, according to the application's policy.</p>
<p>-- <a href="https://www.rfc-editor.org/rfc/rfc9420.html#section-5.3.1-5">RFC9420, Section 5.3.1</a></p>
</blockquote>
<h3 id="application-id-is-not-authenticed-by-as"><a class="header" href="#application-id-is-not-authenticed-by-as">Application ID is Not Authenticed by AS</a></h3>
<blockquote>
<p>However, applications MUST NOT rely on the data in an application_id extension
as if it were authenticated by the Authentication Service, and SHOULD gracefully
handle cases where the identifier presented is not unique.</p>
<p>-- <a href="https://www.rfc-editor.org/rfc/rfc9420.html#section-5.3.3-6">RFC9420, Section 5.3.3</a></p>
</blockquote>
<h2 id="leafnode-validation"><a class="header" href="#leafnode-validation">LeafNode Validation</a></h2>
<h3 id="specifying-the-maximum-total-acceptable-lifetime"><a class="header" href="#specifying-the-maximum-total-acceptable-lifetime">Specifying the Maximum Total Acceptable Lifetime</a></h3>
<blockquote>
<p>Applications MUST define a maximum total lifetime that is acceptable for a
LeafNode, and reject any LeafNode where the total lifetime is longer than this
duration. In order to avoid disagreements about whether a LeafNode has a valid
lifetime, the clients in a group SHOULD maintain time synchronization (e.g.,
using the Network Time Protocol [<a href="https://www.rfc-editor.org/rfc/rfc5905.html">RFC5905</a>]).</p>
<p>-- <a href="https://www.rfc-editor.org/rfc/rfc9420.html#section-7.2-10">RFC9420, Section 7.2</a></p>
</blockquote>
<h2 id="privatemessage-validation"><a class="header" href="#privatemessage-validation">PrivateMessage Validation</a></h2>
<h3 id="structure-of-aad-is-application-defined"><a class="header" href="#structure-of-aad-is-application-defined">Structure of AAD is Application-Defined</a></h3>
<blockquote>
<p>It is up to the application to decide what authenticated_data to provide and
how much padding to add to a given message (if any). The overall size of the
AAD and ciphertext MUST fit within the limits established for the group's AEAD
algorithm in [<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-aead-limits-08">CFRG-AEAD-LIMITS</a>].</p>
<p>-- <a href="https://www.rfc-editor.org/rfc/rfc9420.html#section-6.3.1-11">RFC9420, Section 6.3.1</a></p>
</blockquote>
<p>Therefore, the application must also validate whether the AAD adheres to the
prescribed format.</p>
<h2 id="proposal-validation"><a class="header" href="#proposal-validation">Proposal Validation</a></h2>
<p>When processing a commit, the application has to ensure that the application
specific semantic checks for the validity of the committed proposals are performed.</p>
<p>This should be done on the <code>StagedCommit</code>. Also see the <a href="./user_manual/processing.html">Message Processing</a>
chapter</p>
<pre><code class="language-rust no_run noplayground">    if let ProcessedMessageContent::StagedCommitMessage(staged_commit) =
        alice_processed_message.into_content()
    {
        // We expect a remove proposal
        let remove = staged_commit
            .remove_proposals()
            .next()
            .expect("Expected a proposal.");
        // Check that Bob was removed
        assert_eq!(
            remove.remove_proposal().removed(),
            bob_group.own_leaf_index()
        );
        // Check that Charlie removed Bob
        assert!(matches!(
            remove.sender(),
            Sender::Member(member) if *member == charlies_leaf_index
        ));
        // Merge staged commit
        alice_group
            .merge_staged_commit(alice_provider, *staged_commit)
            .expect("Error merging staged commit.");
    }</code></pre>
<h3 id="external-commits"><a class="header" href="#external-commits">External Commits</a></h3>
<p>The RFC requires the following check</p>
<blockquote>
<p>At most one Remove proposal, with which the joiner removes an old version of themselves. If a Remove proposal is present, then the LeafNode in the path field of the external Commit MUST meet the same criteria as would the LeafNode in an Update for the removed leaf (see Section 12.1.2). In particular, the credential in the LeafNode MUST present a set of identifiers that is acceptable to the application for the removed participant.</p>
</blockquote>
<p>Since OpenMLS does not know the relevant policies, the application MUST ensure
that the credentials are checked according to the policy.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="message_validation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="performance.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="message_validation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="performance.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
